// backspace
void delete_prev_char_from_buf(DynamicBuffer *buf, int x, int y) {
  // if x == 0 && key_backspace -> join current line with previous
  if (y >= buf->line_count) {
    return; // Line number is out of range
  }

  // Get the line to modify
  char *line = buf->data[y];
  size_t line_length = strlen(line);

  // Adjust x if it's beyond the current length of the line
  if (x >= (int)line_length) {
    x = (int)line_length - 1;
  }

  if (x > 0) {
    // Shift characters to the left
    memmove(line + x - 1, line + x, line_length - x + 1);
    // Reallocate memory if needed
    char *new_line = realloc(line, line_length);
    if (!new_line) {
      endwin();
      printf("Failed to reallocate memory for line\n");
      exit(EXIT_FAILURE);
    }
    buf->data[y] = new_line;
  } else {
    // If x is 0, simply remove the first character
    size_t new_length = line_length - 1;
    char *new_line = realloc(line, new_length + 1);
    if (!new_line) {
      endwin();
      printf("Failed to reallocate memory for line\n");
      exit(EXIT_FAILURE);
    }
    memmove(new_line, new_line + 1, new_length);
    new_line[new_length] = '\0';
    buf->data[y] = new_line;
  }
}

// delete
void delete_cur_char_from_buf(DynamicBuffer *buf, int x, int y) {
  if (y >= buf->line_count) {
    return; // Line number is out of range
  }

  // Get the line to modify
  char *line = buf->data[y];
  size_t line_length = strlen(line);

  // Adjust x if it's beyond the current length of the line
  if (x >= (int)line_length) {
    x = (int)line_length - 1;
  }

  // Shift characters to the left
  if (x < (int)line_length - 1) {
    memmove(line + x, line + x + 1, line_length - x);
    // Reallocate memory if needed
    char *new_line = realloc(line, line_length);
    if (!new_line) {
      endwin();
      printf("Failed to reallocate memory for line\n");
      exit(EXIT_FAILURE);
    }
    buf->data[y] = new_line;
  } else {
    // If x is the last character, simply reduce the length

    if (line_length > 1) {

    } else {
      size_t new_length = line_length - 1;
      char *new_line = realloc(line, new_length + 1);
      if (!new_line) {
        endwin();
        printf("Failed to reallocate memory for line\n");
        exit(EXIT_FAILURE);
      }
      new_line[new_length] = '\0';
      buf->data[y] = new_line;
    }

    size_t new_length = line_length - 1;
    char *new_line = realloc(line, new_length + 1);
    if (!new_line) {
      endwin();
      printf("Failed to reallocate memory for line\n");
      exit(EXIT_FAILURE);
    }
    new_line[new_length] = '\0';
    buf->data[y] = new_line;
  }
}
